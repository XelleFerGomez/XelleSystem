<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xelle System | LIMS Dashboard</title>
    <link rel="stylesheet" href="system-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="system-app.js"></script> 
</head>
<body onload="initDashboard()">

    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="brand">XELLE <span style="color:#3498db">SYSTEM</span></div>
            <div class="user-display" id="user-display-sidebar">
                <small>Bienvenido,</small><br>
                <span id="u-name-sidebar">Usuario</span>
            </div>
        </div>

        <div class="sidebar-section filters-section">
            <div class="section-label"><i class="fas fa-filter"></i> Filtros Globales</div>
            
            <label class="filter-label">Tipo de Documento</label>
            <select id="filtro-doc" class="sidebar-select">
                <option value="">-- Seleccionar --</option>
                <option value="PR">PR - Procedimiento</option>
                <option value="PO">PO - Políticas</option>
                <option value="IT">IT - Instrucción Trabajo</option>
                <option value="IE">IE - Instructivo Equipos</option>
                <option value="FO">FO - Formato</option>
                <option value="MC">MC - Manual Calidad</option>
                <option value="MR">MR - Matriz Riesgo</option>
                <option value="OD">OD - Otros</option>
            </select>

            <label class="filter-label">Área</label>
            <select id="filtro-area" class="sidebar-select">
                <option value="">-- Seleccionar --</option>
                <option value="DG">DG - Dirección General</option>
                <option value="LC">LC - Lab. y Calidad</option>
                <option value="OP">OP - Operaciones</option>
                <option value="RS">RS - Regulación Sanitaria</option>
                <option value="AC">AC - Admin y Compras</option>
                <option value="CM">CM - Comercial</option>
                <option value="VE">VE - Ventas</option>
                <option value="CO">CO - Contabilidad</option>
                <option value="FI">FI - Finanzas</option>
            </select>
        </div>

        <div class="sidebar-menu">
            
            <div class="menu-category">Banco de Células</div>
            <a href="#" class="menu-item active" onclick="loadView('resumen', 'Resumen Banco')">
                <i class="fas fa-chart-line"></i> Resumen
            </a>
            <a href="#" class="menu-item" onclick="loadForm('FO-17', 'Recepción')">
                <i class="fas fa-inbox"></i> Recepción <span class="tag">FO-17</span>
            </a>
            <a href="#" class="menu-item" onclick="loadForm('FO-18', 'Evaluación')">
                <i class="fas fa-microscope"></i> Evaluación <span class="tag">FO-18</span>
            </a>
            <a href="#" class="menu-item" onclick="loadForm('FO-20', 'Proceso Cosecha')">
                <i class="fas fa-flask"></i> Proceso <span class="tag">FO-20</span>
            </a>
            <a href="#" class="menu-item" onclick="loadForm('FO-21', 'Bitácora')">
                <i class="fas fa-book"></i> Bitácora <span class="tag">FO-21</span>
            </a>
            <a href="#" class="menu-item" onclick="loadForm('FO-22', 'Dosificación')">
                <i class="fas fa-syringe"></i> Dosificación <span class="tag">FO-22</span>
            </a>

            <div class="menu-category">Laboratorio Calidad</div>
            <a href="#" class="menu-item" onclick="loadView('docs-calidad', 'Documentación LC')">
                <i class="fas fa-folder-open"></i> Documentación
            </a>
            <a href="#" class="menu-item" onclick="loadForm('FO-19', 'Liberación Lote')">
                <i class="fas fa-check-double"></i> Lib. Lote <span class="tag">FO-19</span>
            </a>
            <a href="#" class="menu-item" onclick="loadForm('FO-31', 'Microbiología')">
                <i class="fas fa-bacterium"></i> Micro <span class="tag">FO-31</span>
            </a>
            <div style="margin-top: 40px; padding: 0 20px;">
                <button onclick="logout()" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                </button>
            </div>
        </div>
    </aside>

    <main class="main-content">
        <header class="top-bar">
            <h2 id="page-title">Resumen Operativo</h2>
            <div class="breadcrumbs">Sistema / <span id="breadcrumb-current">General</span></div>
        </header>

        <div id="dynamic-container" class="content-wrapper">
            <div id="default-dashboard" class="dashboard-grid">
                <div class="card card-summary">
                    <h3>Lotes en Proceso</h3>
                    <div class="number">12</div>
                    <div class="desc">Banco de Células</div>
                </div>
                <div class="card card-summary">
                    <h3>Pendientes Calidad</h3>
                    <div class="number text-red">3</div>
                    <div class="desc">Liberación Microbiología</div>
                </div>
                <div class="card card-summary">
                    <h3>Inventario</h3>
                    <div class="number text-green">98%</div>
                    <div class="desc">Capacidad Almacén</div>
                </div>
            </div>
            
            <iframe id="form-frame" class="hidden" src="" frameborder="0"></iframe>
        </div>
    </main>

    <script>
        // Lógica embebida específica para el Dashboard (puede ir a system-app.js)
        
        function initDashboard() {
            // Verificar auth usando tu función existente
            const user = checkAuth(); 
            if(user) {
                document.getElementById('u-name-sidebar').innerText = user.nombre || 'Usuario';
            }
        }

        /* * FUNCIÓN CLAVE: Carga los archivos de la carpeta "Formatos"
         * Asume que tus archivos se llaman por ejemplo "FO-OP-20.html"
         * Si tus archivos tienen nombres distintos, ajusta la lógica aquí.
         */
        function loadForm(codigo, titulo) {
            // 1. Actualizar UI
            document.getElementById('page-title').innerText = `${codigo} - ${titulo}`;
            document.getElementById('breadcrumb-current').innerText = titulo;
            
            // 2. Manejo de clases activas en menú
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');

            // 3. Ocultar dashboard, mostrar iframe
            document.getElementById('default-dashboard').style.display = 'none';
            const frame = document.getElementById('form-frame');
            frame.classList.remove('hidden');
            frame.style.display = 'block';

            // 4. Construir la ruta al archivo
            // IMPORTANTE: Ajusta la ruta si 'Formatos' está en otro nivel
            // Intenta cargar el archivo basándose en el código o un nombre estándar
            let fileName = "";
            
            // Mapeo simple de ejemplo basado en tu prompt
            if(codigo === 'FO-20') fileName = 'Formatos/FO-OP-20.html'; // Ejemplo nombre real
            else if(codigo === 'FO-17') fileName = 'Formatos/FO-BC-17.html';
            else fileName = `Formatos/${codigo}.html`; // Intento genérico

            // Para pruebas, si no existe el archivo, cargará error 404 dentro del iframe
            frame.src = fileName;
        }

        function loadView(view, title) {
            document.getElementById('page-title').innerText = title;
            document.getElementById('breadcrumb-current').innerText = view;
            
            if(view === 'resumen') {
                document.getElementById('form-frame').style.display = 'none';
                document.getElementById('default-dashboard').style.display = 'grid';
            }
        }
    </script>
</body>
</html>